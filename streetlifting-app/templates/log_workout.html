<!DOCTYPE html>
{% extends "general/base.html" %} {% block title %}Registrar Entrenamiento: {{
day_type }}{% endblock %} {% block content %}
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link rel="stylesheet" href="../static/style.css" />
		<script
			src="{{ url_for('static', filename='js/logWorkout.js') }}"
			defer
		></script>
		<title>Registrar Entrenamiento: {{ day_type }}</title>

		<style>
			/* Reinicios mínimos para no tener scroll horizontal */
			html,
			body {
				margin: 0;
				padding: 0;
				overflow-x: hidden; /* Evita desplazamiento horizontal */
				max-width: 100vw; /* Asegura que no crezca más que el viewport */
			}

			/* Estilo básico */
			table {
				margin-bottom: 1em;
				width: 100%; /* Asegura que la tabla ocupe todo el ancho disponible */
			}

			th,
			td {
				text-align: center;
				border: 1px solid #ddd;
				word-wrap: break-word; /* Permite que el texto salte de línea */
			}

			th {
				background-color: #333;
				color: white;
			}

			input {
				border: 1px solid #333;
				background-color: #333;
				color: #e0e0e0;
				width: 100%; /* Para que el input no se desborde */
				box-sizing: border-box; /* Incluye padding y border en el width */
			}

			.suggested-weights-table {
				width: 100%;
				table-layout: fixed; /* Igual para no desbordar */
				margin-top: 20px;
				background-color: #1a1a1a;
				color: #e0e0e0;
				word-wrap: break-word;
			}

			.exercise-container {
				border: 1px solid #444;
				margin-bottom: 1em;
				padding: 1em;
				border-radius: 8px;
				background-color: #1a1a1a;
			}

			.button-container {
				display: flex;
				justify-content: space-between;
				margin-top: 10px;
			}
			.save-button {
				background-color: #ff6f61;
				color: #fff;
				border: none;
				border-radius: 5px;
				cursor: pointer;
				transition: background-color 0.3s ease;
			}
			.save-button,
			.cancel-button {
				font-size: 0.8em;
				padding: 8px;
				margin-top: 10px;
				align-self: center;
				width: 48%; /* Ajusta el ancho para que los botones ocupen el espacio disponible */
			}

			.cancel-button {
				background-color: #ff4c4c;
				color: white;
				border: none;
				border-radius: 5px;
				cursor: pointer;
			}

			.cancel-button:hover {
				background-color: #e63939;
			}

			/* ========================
			   MEDIA QUERIES
			   ======================== */

			/* Para pantallas hasta 768px */
			@media (max-width: 768px) {
				.suggested-weights-table {
					font-size: 0.8em;
				}
				th,
				td {
					font-size: 0.8em;
					padding: 6px;
				}
				input {
					font-size: 0.8em;
				}
				.save-button,
				.cancel-button {
					font-size: 0.8em;
				}
				.btn {
					font-size: 0.6em;
					padding: 6px 12px;
					margin-top: 0px;
				}
			}

			/* Para pantallas hasta 430px */
			@media (max-width: 430px) {
				th,
				td {
					padding: 4px;
					font-size: 0.8em; /* Reduce un poco la fuente */
				}

				input {
					font-size: 0.8em;
				}

				.save-button,
				.cancel-button {
					font-size: 0.8em;
					width: 48%; /* Asegura que los botones ocupen el mismo ancho */
				}
				.btn {
					font-size: 0.6em;
					padding: 4px 8px;
					margin-top: 0px;
				}
			}

			/* Para pantallas aún más pequeñas, hasta 390px */
			@media (max-width: 390px) {
				th,
				td {
					padding: 2px;
					font-size: 0.7em; /* Ajusta el tamaño de la fuente */
				}

				input {
					font-size: 0.7em;
				}

				.save-button,
				.cancel-button {
					font-size: 0.7em;
					width: 48%; /* Asegura que los botones ocupen el mismo ancho */
				}

				.btn {
					font-size: 0.5em;
					padding: 3px 6px;
					margin-top: 0px;
				}
			}
		</style>

		<!-- Script con la lógica de guardado y reconstrucción -->
	</head>
	<body>
		<main>
			<h1>Registrar Entrenamiento: {{ day_type }}</h1>

			<form
				id="workoutForm"
				method="POST"
				aria-labelledby="form-title"
				data-workout-id="{{ pending_workout.id or '' }}"
				data-day-type="{{ day_type or '' }}"
			>
				<!-- Campo oculto para el ID del entrenamiento -->
				<input
					type="hidden"
					name="workout_id"
					value="{{ pending_workout.id or '' }}"
				/>

				<!-- Campo oculto para el tipo de día -->
				<input
					type="hidden"
					id="day_type"
					name="day_type"
					value="{{ day_type }}"
				/>

				<p>
					<label for="date">Fecha:</label>
					<input
						type="date"
						id="date"
						name="date"
						value="{{ today_date }}"
						required
						aria-required="true"
					/>
				</p>

				<h3>Pesos Sugeridos Para Esta Semana</h3>
				{% if suggested_weights %}
				<div class="table-container" aria-label="Tabla de Pesos Sugeridos">
					<table class="suggested-weights-table">
						<thead>
							<tr>
								<th>Ejercicio</th>
								<th>Carga (kg) 3 Reps</th>
								<th>Carga (kg) 5 Reps</th>
								<th>Carga (kg) 8 Reps</th>
							</tr>
						</thead>
						<tbody>
							{% for exercise, weights in suggested_weights.items() %}
							<tr>
								<td>{{ exercise }}</td>
								<td>{{ weights["3x3"] }}</td>
								<td>{{ weights["3x5"] }}</td>
								<td>{{ weights["3x8"] }}</td>
							</tr>
							{% endfor %}
						</tbody>
					</table>
				</div>
				{% else %}
				<p>No hay pesos sugeridos disponibles.</p>
				{% endif %}

				<div id="set-container">
					{% for ex in exercises %} {% set safeName = ex.name|replace('(',
					'')|replace(')', '')|replace(' ', '_') %}
					<div
						id="exercise_{{ safeName }}"
						class="exercise-container"
						data-exercise="{{ safeName }}"
						role="region"
						aria-labelledby="exercise-title-{{ safeName }}"
					>
						<!-- Input oculto para que en el POST se envíe exercise_names -->
						<input type="hidden" name="exercise_names" value="{{ safeName }}" />

						<h3 id="exercise-title-{{ safeName }}">{{ safeName }}</h3>
						<table class="exercise-table">
							<thead>
								<tr>
									<th>Peso (kg)</th>
									<th>Reps</th>
									<th>RPE</th>
									<th>Notas</th>
									<th>Finish?</th>
									<th>Borrar</th>
								</tr>
							</thead>
							<tbody id="sets_{{ safeName }}">
								{% if not ex.sets or ex.sets|length == 0 %}
								<tr>
									<td>
										<input
											type="number"
											name="weight_{{ safeName }}[]"
											step="0.1"
											required
										/>
									</td>
									<td>
										<input
											type="number"
											name="reps_{{ safeName }}[]"
											required
										/>
									</td>
									<td>
										<input
											type="number"
											name="rpe_{{ safeName }}[]"
											step="0.1"
										/>
									</td>
									<td>
										<input type="text" name="notes_{{ safeName }}[]" />
									</td>
									<td>
										<input
											type="checkbox"
											name="completed_{{ safeName }}[]"
											value="true"
											checked
										/>
									</td>
									<td>
										<button type="button" onclick="this.closest('tr').remove()">
											Serie
										</button>
									</td>
								</tr>
								{% else %} {% for s in ex.sets %}
								<tr>
									<td>
										<input
											type="number"
											name="weight_{{ safeName }}[]"
											step="0.1"
											value="{{ s.weight if s.weight else '' }}"
											required
										/>
									</td>
									<td>
										<input
											type="number"
											name="reps_{{ safeName }}[]"
											value="{{ s.reps if s.reps else '' }}"
											required
										/>
									</td>
									<td>
										<input
											type="number"
											name="rpe_{{ safeName }}[]"
											step="0.1"
											value="{{ s.rpe if s.rpe else '' }}"
										/>
									</td>
									<td>
										<input
											type="text"
											name="notes_{{ safeName }}[]"
											value="{{ s.notes if s.notes else '' }}"
										/>
									</td>
									<td>
										<input
											type="checkbox"
											name="completed_{{ safeName }}[]"
											value="true"
											{%
											if
											s.completed
											%}checked{%
											endif
											%}
										/>
									</td>
									<td>
										<button type="button" class="btn" onclick="removeSet(this)">
											Serie
										</button>
									</td>
								</tr>
								{% endfor %} {% endif %}
							</tbody>
						</table>
						<button
							class="btn"
							type="button"
							onclick="addSet('{{ safeName }}')"
						>
							Agregar Serie
						</button>
					</div>
					{% endfor %}
				</div>

				<h3>Agregar Ejercicio</h3>
				<select
					id="exercise-selector"
					aria-label="Selector de Ejercicios"
				></select>
				<button type="button" id="add-exercise-btn" class="btn">
					Agregar Ejercicio
				</button>
				<div class="button-container">
					<button
						type="submit"
						class="save-button"
						name="save_workout"
						value="true"
					>
						Guardar Entrenamiento
					</button>

					<button type="button" id="cancel-workout" class="cancel-button">
						Cancelar Entrenamiento
					</button>
				</div>
			</form>
		</main>
	</body>
</html>
{% endblock %}
