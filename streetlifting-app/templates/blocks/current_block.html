{% extends "general/base.html" %} {% block title %}Inicio - MPDS{% endblock %}
{% block content %}
<!DOCTYPE html>
<div class="current-block">
	<link rel="stylesheet" href="/static/style.css" />

	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	<script src="{{ url_for('static', filename='js/rpeProgChart.js') }}"></script>
	<script
		src="{{ url_for('static', filename='js/progressBlock.js') }}"
		defer
	></script>

	<style>
		.block-container {
			max-width: 100%;
			margin: 0 auto;
			padding: 20px;
			background-color: #1a1a1a;
			color: #e0e0e0;
			border-radius: 10px;
			box-shadow: 0 4px 6px rgba(0, 0, 0, 0.5);
		}

		.block-summary {
			margin-bottom: 20px;
		}

		.progress-bar-container {
			width: 100%;
			height: 20px;
			background-color: #333;
			border-radius: 5px;
			overflow: hidden;
			margin-top: 10px;
		}

		.progress-bar {
			height: 20px;
			background-color: #4caf50;
			transition: width 0.3s ease;
		}

		.lift-projection {
			margin-top: 20px;
		}

		.table {
			width: 100%;
			border-collapse: collapse;
			margin-top: 10px;
		}

		.table th,
		.table td {
			border: 1px solid #ddd;
			padding: 8px;
			text-align: center;
		}

		.button-container {
			display: flex;
			justify-content: space-between;
			margin-top: 20px;
		}

		.hidden {
			display: none;
		}
		.table-responsive {
			overflow-x: auto;
			-webkit-overflow-scrolling: touch; /* Para un desplazamiento suave en dispositivos móviles */
		}

		.table-responsive table {
			width: 100%;
			min-width: 800px; /* Ajusta esto según el tamaño mínimo necesario para tu tabla */
		}

		/* Ajustes adicionales para pantallas pequeñas */
		@media (max-width: 768px) {
			.table-responsive table {
				font-size: 0.8em;
			}
		}

		@media (max-width: 430px) {
			.table-responsive table {
				font-size: 0.7em;
			}
		}
	</style>

	<div class="block-container">
		<div id="training-block-info" class="hidden">
			<h2>Progreso del Bloque de Entrenamiento</h2>
			<p>Etapa Actual: <span id="current-stage"></span></p>
			<p>
				Semana Actual: <span id="current-week"></span> de
				<span id="total-weeks"></span>
			</p>
			<div class="progress-bar-container">
				<div id="progress" class="progress-bar"></div>
			</div>
		</div>
		<div id="no-block-info" class="hidden">
			<p>No hay bloques de entrenamiento activos en este momento.</p>
		</div>
		{% if block and block.status == "in_progress" %}
		<div class="block-summary">
			<p><strong>Nombre:</strong> {{ block.name }}</p>
			<p><strong>Duración:</strong> {{ block.duration }} semanas</p>
			<p><strong>Inicio:</strong> {{ block.start_date }}</p>
			<p><strong>Fin:</strong> {{ block.end_date }}</p>
		</div>

		<!-- Detalles adicionales -->
		<button id="toggle-details" class="btn">Ver Más Detalles</button>
		<div id="block-details" class="hidden">
			<p><strong>Estrategia:</strong> {{ block.strategy }}</p>
			<p>
				<strong>Incremento Semanal:</strong>
				{% if block.increment_type == "absolute" %} {{ block.weekly_increment }}
				kg {% else %} {{ block.weekly_increment }}% {% endif %}
			</p>
			<p>
				<strong>Semana de Descarga:</strong> {{ block.deload_week or "N/A" }}
			</p>
			<p><strong>RM Pull-Ups:</strong> {{ block.rm_pullups }} kg</p>
			<p><strong>RM Dips:</strong> {{ block.rm_dips }} kg</p>
			<p><strong>RM Muscle-Ups:</strong> {{ block.rm_muscleups }} kg</p>
			<p><strong>RM Squats:</strong> {{ block.rm_squats }} kg</p>
		</div>

		<!-- Progresión por ejercicios -->
		{% for lift in progression_by_reps.keys() %}
		<div class="lift-projection">
			<h3>{{ lift }}</h3>

			<!-- Tabla de Progresión por Semanas -->
			<div class="table-responsive">
				<table class="table table-bordered table-striped">
					<thead>
						<tr>
							<th>Semana</th>
							<th>Carga (kg) 3 Reps</th>
							<th>Carga (kg) 5 Reps</th>
							<th>Carga (kg) 8 Reps</th>
						</tr>
					</thead>
					<tbody>
						{% for week, data in progression_by_reps[lift].items() %}
						<tr>
							<td>{{ week }}</td>
							<td>{{ data["3 reps"] }}</td>
							<td>{{ data["5 reps"] }}</td>
							<td>{{ data["8 reps"] }}</td>
						</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>

			<!-- Toggle para Tabla de RPE -->
			<button class="btn btn-secondary toggle-rpe" data-lift="{{ lift }}">
				Mostrar Tabla de RPE
			</button>
			<div id="rpe-table-{{ lift }}" class="hidden table-responsive">
				<h4>Tabla de RPE</h4>
				<table class="table table-bordered table-striped">
					<thead>
						<tr>
							<th>RPE</th>
							{% for rep in range(1, 13) %}
							<th>{{ rep }} Reps</th>
							{% endfor %}
						</tr>
					</thead>
					<tbody>
						{% for rpe, values in rpe_tables[lift].items() %}
						<tr>
							<td>{{ rpe }}</td>
							{% for value in values %}
							<td>{{ value }}</td>
							{% endfor %}
						</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>
		</div>
		{% endfor %}

		<!-- Botones para editar/eliminar el bloque -->
		<div class="button-container">
			<form
				method="GET"
				action="{{ url_for('blocks.edit_block', block_id=block.id) }}"
			>
				<button type="submit" class="btn">Editar Bloque</button>
			</form>
			<form
				method="POST"
				action="{{ url_for('blocks.delete_block_by_id', block_id=block.id) }}"
			>
				<button type="submit" class="btn btn-secondary">Eliminar Bloque</button>
			</form>
		</div>
		{% else %}
		<p>
			No hay bloques de entrenamiento activos en este momento.
			<a href="{{ url_for('blocks.create_block') }}" class="btn"
				>Crear un nuevo bloque</a
			>
		</p>
		{% endif %}

		<h2>Historial de Bloques</h2>
		<div id="history-container">
			<p id="no-history-message" class="hidden">
				No hay bloques completados en el historial.
			</p>
			<table id="history-table" class="table hidden">
				<thead>
					<tr>
						<th>Nombre</th>
						<th>Duración</th>
						<th>Inicio</th>
						<th>Fin</th>
						<th>Estatus</th>
					</tr>
				</thead>
				<tbody></tbody>
			</table>
		</div>
	</div>

	<script>
		document.addEventListener("DOMContentLoaded", function () {
			// Mostrar/ocultar detalles del bloque
			const toggleButton = document.getElementById("toggle-details");
			const detailsSection = document.getElementById("block-details");
			if (toggleButton) {
				toggleButton.addEventListener("click", function () {
					detailsSection.classList.toggle("hidden");
					toggleButton.textContent = detailsSection.classList.contains("hidden")
						? "Ver Más Detalles"
						: "Ocultar Detalles";
				});
			}

			// Mostrar/ocultar tablas de RPE
			document.querySelectorAll(".toggle-rpe").forEach((button) => {
				button.addEventListener("click", function () {
					const lift = this.dataset.lift;
					const rpeTable = document.getElementById(`rpe-table-${lift}`);
					if (rpeTable) {
						rpeTable.classList.toggle("hidden");
						this.textContent = rpeTable.classList.contains("hidden")
							? "Mostrar Tabla de RPE"
							: "Ocultar Tabla de RPE";
					}
				});
			});
		});
	</script>
</div>
{% endblock %}
