{% extends "general/base.html" %}
{% block title %}Agregar Rutina{% endblock %}
{% block content %}
<div class="container">
	<style>
		/* Estilos para el formulario de agregar rutina */
.container {
    max-width: 800px;
    margin: 0 auto;
    padding: 20px;
    background-color: #1a1a1a;
    border-radius: 10px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.5);
}

.title {
    font-size: 2.5em;
    color: #ff6f61;
    text-align: center;
    margin-bottom: 20px;
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    font-size: 1.2em;
    color: #e0e0e0;
    margin-bottom: 5px;
}

.form-control {
    width: 100%;
    padding: 10px;
    font-size: 1em;
    color: #0d0d0d;
    background-color: #e0e0e0;
    border: 1px solid #333;
    border-radius: 5px;
}

.days-checkboxes label {
    display: inline-block;
    margin-right: 10px;
    font-size: 1em;
    color: #e0e0e0;
}

.days-checkboxes input {
    margin-right: 5px;
}

.form-text {
    font-size: 0.9em;
    color: #b3b3b3;
}

.exercise-item {
    display: flex;
    align-items: center;
    margin-bottom: 10px;
}

.exercise-item select {
    flex: 1;
    margin-right: 10px;
}

.exercise-item input[type="checkbox"] {
    margin-right: 5px;
}

.exercise-item label {
    margin-right: 10px;
    color: #e0e0e0;
}

.remove-exercise {
    margin-left: 10px;
}

.form-actions {
    text-align: center;
    margin-top: 20px;
}

.btn {
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 1em;
    transition: background-color 0.3s ease;
}

.btn-primary {
    background-color: #007bff;
    color: white;
}

.btn-secondary {
    background-color: #6c757d;
    color: white;
}

.btn-danger {
    background-color: #dc3545;
    color: white;
}

.btn-primary:hover {
    background-color: #0056b3;
}

.btn-secondary:hover {
    background-color: #5a6268;
}

.btn-danger:hover {
    background-color: #c82333;
}</style>
    <h1 class="title">Agregar Nueva Rutina</h1>

    <!-- Formulario para agregar una nueva rutina -->
    <form method="POST" action="{{ url_for('routines.add_routine_route') }}">
        <!-- Campo para el nombre de la rutina -->
        <div class="form-group">
            <label for="name">Nombre de la Rutina:</label>
            <input
                type="text"
                id="name"
                name="name"
                class="form-control"
                placeholder="Ejemplo: Primary Pull"
                required
            />
        </div>

        <!-- Selección de días -->
        <div class="form-group">
            <label>Días de la Semana:</label>
            <div class="days-checkboxes">
                <label><input type="checkbox" name="days[]" value="0"> Lunes</label>
                <label><input type="checkbox" name="days[]" value="1"> Martes</label>
                <label><input type="checkbox" name="days[]" value="2"> Miércoles</label>
                <label><input type="checkbox" name="days[]" value="3"> Jueves</label>
                <label><input type="checkbox" name="days[]" value="4"> Viernes</label>
                <label><input type="checkbox" name="days[]" value="5"> Sábado</label>
                <label><input type="checkbox" name="days[]" value="6"> Domingo</label>
            </div>
            <small class="form-text text-muted">
                Selecciona uno o varios días en los que realizarás esta rutina.
            </small>
        </div>

        <!-- Lista dinámica de ejercicios -->
        <div class="form-group">
            <label for="exercises">Ejercicios:</label>
            <div id="exercise-list">
                <!-- Primer ejercicio inicial con Main Lift por defecto -->
                <div class="exercise-item">
                    <select name="exercises[]" class="form-control exercise-select" required>
                        <option value="">Selecciona un ejercicio</option>
                        {% for exercise in exercises|sort %}
                        <option value="{{ exercise }}" {% if exercise in ["Pull-Up", "Weighted Dips", "Muscle-Up", "Squat"] %}selected{% endif %}>
                            {{ exercise }}
                        </option>
                        {% endfor %}
                    </select>
                    <input
                        type="checkbox"
                        name="main_lift[]"
                        value="Pull-Up"
                        id="main-lift-1"
                        {% if "Pull-Up" in ["Pull-Up", "Weighted Dips", "Muscle-Up", "Squat"] %}checked{% endif %}
                    />
                    <label for="main-lift-1">Es Main Lift?</label>
                </div>
            </div>
            <button type="button" id="add-exercise" class="btn btn-secondary">
                Agregar Ejercicio
            </button>
        </div>

        <!-- Botones de acción -->
        <div class="form-actions">
            <button type="submit" class="btn btn-primary">Guardar Rutina</button>
            <a href="{{ url_for('routines.view_routines') }}" class="btn btn-secondary">Cancelar</a>
        </div>
    </form>
</div>

<!-- Script para gestionar la lista dinámica de ejercicios -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const exerciseList = document.getElementById("exercise-list");
        const addExerciseBtn = document.getElementById("add-exercise");
        const availableExercises = {{ exercises | sort | tojson }};

        // Función para crear un nuevo elemento de ejercicio
        function createExerciseItem() {
            const newExerciseItem = document.createElement("div");
            newExerciseItem.classList.add("exercise-item");

            let optionsHtml = `<option value="">Selecciona un ejercicio</option>`;
            availableExercises.forEach((exercise) => {
                optionsHtml += `<option value="${exercise}">${exercise}</option>`;
            });

            newExerciseItem.innerHTML = `
                <select name="exercises[]" class="form-control exercise-select" required>
                    ${optionsHtml}
                </select>
                <input type="checkbox" name="main_lift[]" value="" />
                <label>Es Main Lift</label>
                <button type="button" class="btn btn-danger remove-exercise">Eliminar</button>
            `;

            // Ajustar el valor y estado del checkbox según el ejercicio seleccionado
            const select = newExerciseItem.querySelector(".exercise-select");
            const checkbox = newExerciseItem.querySelector("[name='main_lift[]']");
            select.addEventListener("change", () => {
                checkbox.value = select.value;
                checkbox.checked = ["Pull-Up", "Weighted Dips", "Muscle-Up", "Squat"].includes(select.value);
            });

            // Agregar evento de eliminación
            newExerciseItem.querySelector(".remove-exercise").addEventListener("click", () => {
                exerciseList.removeChild(newExerciseItem);
            });

            return newExerciseItem;
        }

        // Evento para agregar un nuevo ejercicio
        addExerciseBtn.addEventListener("click", () => {
            const newExerciseItem = createExerciseItem();
            exerciseList.appendChild(newExerciseItem);
        });

        // Manejar eliminación de ejercicios existentes
        document.querySelectorAll(".remove-exercise").forEach((button) => {
            button.addEventListener("click", (event) => {
                const exerciseItem = event.target.closest(".exercise-item");
                exerciseList.removeChild(exerciseItem);
            });
        });
    });
</script>
{% endblock %}
